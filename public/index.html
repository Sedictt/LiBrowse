<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LiBrowse - Smart Academic Book Exchange for PLV</title>
    <meta name="description"
        content="LiBrowse - The smart way for PLV students to lend and borrow academic books. Build your academic network through book sharing.">
    <meta name="keywords"
        content="LiBrowse, PLV, book exchange, student books, academic books, university, lending, book sharing">
    <meta name="author" content="LiBrowse Team">
    <link rel="icon" type="image/png" href="./assets/LibrowseLogo.png">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700;800;900&display=swap"
        rel="stylesheet">
    <link rel="stylesheet" href="./css/style.css?v=2.3">
    <link rel="stylesheet" href="./css/new-landing.css?v=1.0">
    <link rel="stylesheet" href="./css/bookManagement.css?v=1.0">
    <link rel="stylesheet" href="./css/chat-modal.css?v=1.0">
    <!-- Flatpickr for improved date/time pickers -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/flatpickr.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/flatpickr/dist/themes/dark.css">
    <script src="https://cdn.jsdelivr.net/npm/flatpickr"></script>

    <style>
        /* Fallback styles to ensure basic functionality */
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            background: #0f0f23;
            color: white;
        }

        .loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #0f0f23;
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 9999;
        }

        .navbar {
            background: rgba(26, 29, 41, 0.95);
            backdrop-filter: blur(20px);
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 1000;
        }

        .nav-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 1.5rem;
            display: flex;
            align-items: center;
            justify-content: space-between;
            height: 70px;
        }

        .nav-menu {
            display: flex;
            align-items: center;
            gap: 1.5rem;
        }

        .nav-auth {
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
    </style>
</head>

<body>
    <!-- Loading Screen -->
    <div id="loading-screen" class="loading-screen">
        <div class="loading-content">
            <div class="loading-book-animation">
                <div class="book">
                    <div class="book-page"></div>
                    <div class="book-page"></div>
                    <div class="book-page"></div>
                </div>
            </div>
            <div class="loading-brand">
                <img src="./assets/LibrowseLogo.png" alt="LiBrowse Logo" class="loading-logo-img">
                <h1 class="loading-title">LiBrowse</h1>
            </div>
            <div class="loading-text">Smart Academic Book Exchange for PLV</div>
            <div class="loading-progress">
                <div class="progress-bar"></div>
            </div>
            <p class="loading-subtitle">Connecting Students Through Books</p>
        </div>
    </div>

    <!-- Navigation -->
    <nav class="navbar" id="navbar">
        <div class="nav-container">
            <div class="nav-brand">
                <div class="brand-logo">
                    <img src="./assets/LibrowseLogo.png" alt="LiBrose Logo">
                </div>
                <span class="brand-text">LiBrowse</span>
            </div>
            <div class="nav-menu" id="nav-menu">
                <a href="#home" class="nav-link active" data-section="home">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#books" class="nav-link" data-section="books">
                    <i class="fas fa-book-open"></i>
                    <span>Books</span>
                </a>
                <a href="#requests" class="nav-link" data-section="requests">
                    <i class="fas fa-handshake"></i>
                    <span>Requests</span>
                    <span class="notification-badge" id="requests-badge">0</span>
                </a>
                <a href="#monitoring" class="nav-link" data-section="monitoring">
                    <i class="fas fa-chart-line"></i>
                    <span>Monitoring</span>
                    <span class="notification-badge" id="monitoring-badge">0</span>
                </a>
                <a href="#profile" class="nav-link" data-section="profile">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
                <a href="#notifications" class="nav-link" data-section="notifications">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                    <span class="notification-badge" id="notification-badge">0</span>
                </a>
                <!-- Mobile Auth Buttons -->
                <div class="mobile-auth-wrapper">
                    <button class="btn btn-outline" id="mobile-login-btn">Login</button>
                    <button class="btn btn-primary" id="mobile-register-btn">Register</button>
                </div>
            </div>
            <div class="nav-auth" id="nav-auth">
                <button class="btn btn-outline" id="login-btn">Login</button>
                <button class="btn btn-primary" id="register-btn">Register</button>
            </div>
            <div class="nav-user hidden" id="nav-user">
                <div class="user-avatar" id="user-avatar">
                    <i class="fas fa-user"></i>
                </div>
                <div class="user-dropdown" id="user-dropdown">
                    <div class="dropdown-item" id="profile-link">
                        <i class="fas fa-user"></i>
                        <span>Profile</span>
                    </div>
                    <div class="dropdown-item" id="settings-link">
                        <i class="fas fa-cog"></i>
                        <span>Settings</span>
                    </div>
                    <div class="dropdown-divider"></div>
                    <div class="dropdown-item" id="logout-btn">
                        <i class="fas fa-sign-out-alt"></i>
                        <span>Logout</span>
                    </div>
                </div>
            </div>
            <div class="nav-toggle" id="nav-toggle">
                <span></span>
                <span></span>
                <span></span>
            </div>
        </div>
    </nav>

    <!-- Notification Dropdown Panel -->
    <div class="notification-dropdown" id="notification-dropdown">
        <div class="notification-header">
            <h3><i class="fas fa-bell"></i> Notifications</h3>
            <button class="btn-text" id="mark-all-read-btn">
                <i class="fas fa-check-double"></i> Mark all read
            </button>
        </div>

        <div class="notification-tabs">
            <button class="notification-tab active" data-tab="all">All</button>
            <button class="notification-tab" data-tab="unread">Unread</button>
        </div>

        <div class="notification-list" id="notification-list">
            <div class="notification-loading">
                <i class="fas fa-spinner fa-spin"></i> Loading notifications...
            </div>
        </div>

        <div class="notification-footer">
            <a href="#notifications" class="btn-text" onclick="app.switchSection('notifications')">
                View All Notifications
            </a>
        </div>
    </div>


    <!-- Main Content -->
    <main class="main-content">
        <!-- Home Section -->
        <section id="home-section" class="section active">
            <!-- Hero Section -->
            <div class="hero-new">
                <div class="hero-background">
                    <div class="hero-shapes">
                        <div class="shape shape-1"></div>
                        <div class="shape shape-2"></div>
                        <div class="shape shape-3"></div>
                    </div>
                </div>
                <div class="container">
                    <div class="hero-content-new">
                        <div class="hero-badge">
                            <i class="fas fa-university"></i>
                            <span>For PLV Students</span>
                        </div>
                        <h1 class="hero-title-new">
                            Your Academic Books,
                            <span class="gradient-text-new">Shared Smarter</span>
                        </h1>
                        <p class="hero-subtitle">
                            Connect with fellow PLV students to borrow and lend textbooks.
                            Save money, build connections, and make learning more accessible.
                        </p>
                        <div class="hero-buttons">
                            <button class="btn-new btn-primary-new" id="get-started-btn">
                                <span>Get Started Free</span>
                                <i class="fas fa-arrow-right"></i>
                            </button>
                            <button class="btn-new btn-secondary-new" id="learn-more-btn">
                                <i class="fas fa-play-circle"></i>
                                <span>How It Works</span>
                            </button>
                        </div>
                        <div class="hero-features">
                            <div class="hero-feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>100% Free</span>
                            </div>
                            <div class="hero-feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Verified Students</span>
                            </div>
                            <div class="hero-feature-item">
                                <i class="fas fa-check-circle"></i>
                                <span>Secure Platform</span>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Stats Section -->
            <div class="stats-section-new">
                <div class="container">
                    <div class="stats-grid-new">
                        <div class="stat-card-new">
                            <div class="stat-number-new" id="total-users">150+</div>
                            <div class="stat-label-new">Active Students</div>
                        </div>
                        <div class="stat-card-new">
                            <div class="stat-number-new" id="total-books">320+</div>
                            <div class="stat-label-new">Books Shared</div>
                        </div>
                        <div class="stat-card-new">
                            <div class="stat-number-new" id="total-transactions">245+</div>
                            <div class="stat-label-new">Successful Exchanges</div>
                        </div>
                        <div class="stat-card-new">
                            <div class="stat-number-new" id="avg-rating">4.7â˜…</div>
                            <div class="stat-label-new">Average Rating</div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- Features Section -->
            <div class="features-section">
                <div class="container">
                    <div class="section-header-new">
                        <h2 class="section-title-new">Why Choose LiBrowse?</h2>
                        <p class="section-subtitle-new">Everything you need to share and borrow books with confidence
                        </p>
                    </div>
                    <div class="features-grid">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-shield-alt"></i>
                            </div>
                            <h3 class="feature-title">Safe & Secure</h3>
                            <p class="feature-description">
                                Only verified PLV students can join. Your books are protected with our trust-based
                                credit system.
                            </p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-search"></i>
                            </div>
                            <h3 class="feature-title">Smart Search</h3>
                            <p class="feature-description">
                                Find exactly what you need by course code, subject, program, or book condition in
                                seconds.
                            </p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-comments"></i>
                            </div>
                            <h3 class="feature-title">Direct Chat</h3>
                            <p class="feature-description">
                                Message book owners directly to arrange pickups and discuss book details privately.
                            </p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <h3 class="feature-title">Rating System</h3>
                            <p class="feature-description">
                                Build your reputation through ratings and reviews from fellow students.
                            </p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-bell"></i>
                            </div>
                            <h3 class="feature-title">Real-time Notifications</h3>
                            <p class="feature-description">
                                Get instant alerts for requests, messages, and important updates about your books.
                            </p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <i class="fas fa-mobile-alt"></i>
                            </div>
                            <h3 class="feature-title">Mobile Friendly</h3>
                            <p class="feature-description">
                                Access LiBrowse anywhere, anytime from your phone, tablet, or computer.
                            </p>
                        </div>
                    </div>
                </div>
            </div>

            <!-- How It Works Section -->
            <div class="how-it-works-section">
                <div class="container">
                    <div class="section-header-new">
                        <h2 class="section-title-new">How It Works</h2>
                        <p class="section-subtitle-new">Start sharing books in 3 simple steps</p>
                    </div>
                    <div class="steps-grid">
                        <div class="step-card">
                            <div class="step-number">1</div>
                            <div class="step-content">
                                <h3 class="step-title">Create Account</h3>
                                <p class="step-description">
                                    Sign up with your PLV email address and verify your student status in minutes.
                                </p>
                            </div>
                            <div class="step-icon">
                                <i class="fas fa-user-plus"></i>
                            </div>
                        </div>
                        <div class="step-card">
                            <div class="step-number">2</div>
                            <div class="step-content">
                                <h3 class="step-title">List or Browse Books</h3>
                                <p class="step-description">
                                    Add books you want to lend or search for books you need for your courses.
                                </p>
                            </div>
                            <div class="step-icon">
                                <i class="fas fa-book-open"></i>
                            </div>
                        </div>
                        <div class="step-card">
                            <div class="step-number">3</div>
                            <div class="step-content">
                                <h3 class="step-title">Connect & Exchange</h3>
                                <p class="step-description">
                                    Send requests, chat with book owners, and arrange safe exchanges on campus.
                                </p>
                            </div>
                            <div class="step-icon">
                                <i class="fas fa-handshake"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <!-- CTA Section -->
            <div class="cta-section">
                <div class="container">
                    <div class="cta-content">
                        <h2 class="cta-title">Ready to Start Sharing?</h2>
                        <p class="cta-description">
                            Join hundreds of PLV students who are already saving money and building connections through
                            book sharing.
                        </p>
                        <button class="btn-new btn-cta" id="cta-register-btn">
                            <span>Create Free Account</span>
                            <i class="fas fa-arrow-right"></i>
                        </button>
                    </div>
                </div>
            </div>
        </section>

        <!-- Books Section (Hidden for now) -->
        <section id="books-section" class="section">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Available Books</h2>
                    <button class="btn btn-primary" id="add-book-btn">
                        <i class="fas fa-plus"></i>
                        Add Book
                    </button>
                </div>

                <!-- Search and Filters -->
                <div class="search-filters">
                    <div class="search-bar">
                        <i class="fas fa-search"></i>
                        <input type="text" id="book-search" placeholder="Search books by title, author, or course...">
                    </div>
                    <div class="filters">
                        <select id="program-filter" class="filter-select">
                            <option value="">All Programs</option>
                            <option value="BSIT">BS Information Technology</option>
                            <option value="BSA">BS Accountancy</option>
                            <option value="BSED">BS Education</option>
                            <option value="BSENG">BS Engineering</option>
                        </select>
                        <select id="condition-filter" class="filter-select">
                            <option value="">All Conditions</option>
                            <option value="excellent">Excellent</option>
                            <option value="good">Good</option>
                            <option value="fair">Fair</option>
                        </select>
                        <select id="availability-filter" class="filter-select">
                            <option value="">All Books</option>
                            <option value="available">Available</option>
                            <option value="borrowed">Borrowed</option>
                        </select>
                        <select id="sort-filter" class="filter-select">
                            <option value="">Sort By...</option>
                            <option value="newest">Newest First</option>
                            <option value="oldest">Oldest First</option>
                            <option value="titleasc">Title (A-Z)</option>
                            <option value="titledesc">Title (Z-A)</option>
                            <option value="creditslow">Credits (Low to High)</option>
                            <option value="creditshigh">Credits (High to Low)</option>
                        </select>
                    </div>
                </div>

                <!-- Saved Searches Panel -->
                <div class="saved-searches-panel">
                    <div class="saved-searches-header">
                        <h3><i class="fas fa-bookmark"></i> Saved Searches</h3>
                        <button class="btn btn-sm btn-primary" id="save-search-btn" title="Save current search">
                            <i class="fas fa-save"></i> Save Current Search
                        </button>
                    </div>
                    <div class="saved-searches-list" id="saved-searches-list">
                        <!-- Saved searches will be loaded here dynamically -->
                        <p class="empty-state">No saved searches yet</p>
                    </div>
                </div>

                <!-- Recently Viewed Books -->
                <div class="recently-viewed-section" id="recently-viewed-section" style="display: none;">
                    <div class="section-header-small">
                        <h3><i class="fas fa-history"></i> Recently Viewed</h3>
                        <a href="#" class="view-all-link" id="view-all-recent">View All</a>
                    </div>
                    <div class="recently-viewed-books" id="recently-viewed-books">
                        <!-- Recently viewed books will be loaded here -->
                    </div>
                </div>


                <!-- Books Grid -->
                <div class="books-grid" id="books-grid">
                    <!-- Books will be loaded dynamically -->
                </div>

                <!-- Load More -->
                <div class="load-more-container">
                    <button class="btn btn-outline" id="load-more-books">
                        <i class="fas fa-chevron-down"></i>
                        Load More Books
                    </button>
                </div>
            </div>
        </section>

        <!-- Borrow Requests Management Section (Hidden for now) -->
        <section id="requests-section" class="section" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Borrow Requests</h2>
                    <div class="request-tabs">
                        <button class="tab-btn active" data-tab="incoming">
                            <i class="fas fa-inbox"></i>
                            Incoming Requests
                            <span class="badge" id="incoming-count">0</span>
                        </button>
                        <button class="tab-btn" data-tab="outgoing">
                            <i class="fas fa-paper-plane"></i>
                            My Requests
                        </button>
                        <button class="tab-btn" data-tab="active-chats">
                            <i class="fas fa-comments"></i>
                            Active Chats
                            <span class="badge" id="chat-count">0</span>
                        </button>
                    </div>
                </div>

                <!-- Filter Bar (for incoming requests) -->
                <div class="filter-bar" id="requests-filter-bar" style="display: none;">
                    <div class="filter-grid">
                        <input type="text" class="filter-input" id="filter-book-title"
                            placeholder="Filter by book title...">
                        <input type="text" class="filter-input" id="filter-borrower-name"
                            placeholder="Filter by borrower name...">
                        <select class="filter-input" id="filter-status">
                            <option value="">All Statuses</option>
                            <option value="pending">Pending</option>
                            <option value="approved">Approved</option>
                            <option value="rejected">Rejected</option>
                            <option value="cancelled">Cancelled</option>
                            <option value="borrowed">Borrowed</option>
                            <option value="returned">Returned</option>
                        </select>
                        <div class="filter-date-group">
                            <label for="filter-date-from" class="filter-label">From Date</label>
                            <input type="date" class="filter-input" id="filter-date-from">
                        </div>
                        <div class="filter-date-group">
                            <label for="filter-date-to" class="filter-label">To Date</label>
                            <input type="date" class="filter-input" id="filter-date-to">
                        </div>
                    </div>
                </div>

                <!-- Incoming Requests Tab -->
                <div id="incoming-tab" class="tab-content active">
                    <div class="requests-grid" id="incoming-requests">
                        <!-- Incoming requests will be loaded here -->
                    </div>
                </div>

                <!-- Outgoing Requests Tab -->
                <div id="outgoing-tab" class="tab-content">
                    <div class="requests-grid" id="outgoing-requests">
                        <!-- Outgoing requests will be loaded here -->
                    </div>
                </div>

                <!-- Active Chats Tab -->
                <div id="active-chats-tab" class="tab-content">
                    <div class="chats-grid" id="active-chats">
                        <!-- Active chats will be loaded here -->
                    </div>
                </div>
            </div>
        </section>

        <!-- Book Monitoring Section (Hidden for now) -->
        <section id="monitoring-section" class="section" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <div class="section-title-group">
                        <h2 class="section-title">Book Monitoring</h2>
                        <div class="monitoring-controls">
                            <button class="btn btn-ghost btn-sm" id="refresh-transactions" title="Refresh transactions">
                                <i class="fas fa-sync-alt"></i>
                                Refresh
                            </button>
                            <span class="last-refresh" id="last-refresh-time">Loading...</span>
                        </div>
                    </div>
                    <div class="monitoring-tabs">
                        <button class="tab-btn active" data-tab="active">
                            <i class="fas fa-clock"></i>
                            Active Transactions
                            <span class="badge" id="active-count">0</span>
                        </button>
                        <button class="tab-btn" data-tab="pending-feedback">
                            <i class="fas fa-star"></i>
                            Pending Feedback
                            <span class="badge" id="feedback-count">0</span>
                        </button>
                        <button class="tab-btn" data-tab="completed">
                            <i class="fas fa-check-circle"></i>
                            Completed
                        </button>
                        <button class="tab-btn" data-tab="overdue">
                            <i class="fas fa-exclamation-triangle"></i>
                            Overdue
                            <span class="badge error" id="overdue-count">0</span>
                        </button>
                    </div>
                </div>

                <!-- Active Transactions Tab -->
                <div class="monitoring-content">
                    <div class="tab-content active" id="active-tab">
                        <div class="monitoring-grid" id="active-transactions">
                            <!-- Active transactions will be loaded here -->
                        </div>
                    </div>

                    <!-- Pending Feedback Tab -->
                    <div class="tab-content" id="pending-feedback-tab">
                        <div class="monitoring-grid" id="pending-feedback-transactions">
                            <!-- Transactions needing feedback will be loaded here -->
                        </div>
                    </div>

                    <!-- Completed Tab -->
                    <div class="tab-content" id="completed-tab">
                        <div class="monitoring-grid" id="completed-transactions">
                            <!-- Completed transactions will be loaded here -->
                        </div>
                    </div>

                    <!-- Overdue Tab -->
                    <div class="tab-content" id="overdue-tab">
                        <div class="monitoring-grid" id="overdue-transactions">
                            <!-- Overdue transactions will be loaded here -->
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Profile Section (Hidden for now) -->
        <section id="profile-section" class="section">
            <div class="container">
                <div class="profile-content">
                    <div class="profile-sidebar">
                        <div class="profile-card">
                            <div class="profile-header">
                                <div class="profile-avatar">
                                    <img id="profile-image" src="/assets/default-avatar.svg" alt="Profile"
                                        onerror="this.onerror=null;this.src='/assets/default-avatar.svg'">
                                    <button class="avatar-edit" id="edit-avatar">
                                        <i class="fas fa-camera"></i>
                                    </button>
                                </div>
                                <div class="profile-info">
                                    <div class="profile-name-section">
                                        <h3 id="profile-name">Loading...</h3>
                                        <div class="profile-badges">
                                            <div class="verification-badge verified" id="verification-badge">
                                                <i class="fas fa-check-circle"></i>
                                                <span>Verified</span>
                                            </div>
                                        </div>
                                    </div>
                                    <p id="profile-email" class="profile-email">Loading...</p>
                                    <p id="profile-student-id" class="profile-student-id">Loading...</p>
                                    <p id="profile-program" class="profile-program">Loading...</p>
                                </div>
                            </div>

                            <div class="profile-credits">
                                <div class="credits-header">
                                    <i class="fas fa-coins"></i>
                                    <span>Current Credits</span>
                                </div>
                                <div class="credits-value" id="user-credits">0</div>
                                <div class="credits-description">
                                    Credits are earned by lending books and maintaining good ratings
                                </div>
                            </div>

                            <div class="profile-stats">
                                <div class="stat">
                                    <div class="stat-icon">
                                        <i class="fas fa-book"></i>
                                    </div>
                                    <div class="stat-content">
                                        <span class="stat-value" id="user-books">0</span>
                                        <span class="stat-label">Books Listed</span>
                                    </div>
                                </div>
                                <div class="stat">
                                    <div class="stat-icon">
                                        <i class="fas fa-exchange-alt"></i>
                                    </div>
                                    <div class="stat-content">
                                        <span class="stat-value" id="user-transactions">0</span>
                                        <span class="stat-label">Transactions</span>
                                    </div>
                                </div>
                                <div class="stat">
                                    <div class="stat-icon">
                                        <i class="fas fa-star"></i>
                                    </div>
                                    <div class="stat-content">
                                        <span class="stat-value" id="user-rating">0.0</span>
                                        <span class="stat-label">Rating</span>
                                    </div>
                                </div>
                            </div>

                            <div class="profile-actions">
                                <button class="btn btn-primary btn-full" id="edit-profile-btn">
                                    <i class="fas fa-edit"></i>
                                    Edit Profile
                                </button>
                            </div>
                        </div>
                    </div>
                    <div class="profile-main">
                        <div class="profile-tabs">
                            <button class="tab-btn active" data-tab="info">Personal Info</button>
                            <button class="tab-btn" data-tab="verification">Verification</button>
                            <button class="tab-btn" data-tab="books">My Books</button>
                            <button class="tab-btn" data-tab="reviews">Reviews</button>
                            <button class="tab-btn" data-tab="settings">Settings</button>
                            <button class="tab-btn" data-tab="borrowing-history">Borrowing & Lending History</button>
                        </div>
                        <div class="profile-tab-content">
                            <!-- Personal Info Tab -->
                            <div class="tab-content active" id="info-content" style="display: block;">
                                <div class="info-section">
                                    <h3>Personal Information</h3>
                                    <p>View and manage your account information.</p>
                                </div>
                            </div>

                            <!-- Verification Tab -->
                            <div class="tab-content" id="verification-content" style="display: none;">
                                <div class="verification-section"
                                    style="padding: 30px; background: rgba(255,255,255,0.05); border-radius: 12px;">
                                    <h3 style="margin-bottom: 15px; color: #fff;">Account Verification</h3>
                                    <p style="margin-bottom: 30px; color: #a0aec0;">Verify your account to access all
                                        features of LiBrowse.</p>

                                    <div class="verification-status" id="verification-status-display"
                                        style="margin-bottom: 30px;">
                                        <div class="status-card pending"
                                            style="padding: 20px; background: rgba(251, 191, 36, 0.1); border: 2px solid rgba(251, 191, 36, 0.3); border-radius: 8px; text-align: center;">
                                            <i class="fas fa-clock"
                                                style="font-size: 48px; color: #fbbf24; margin-bottom: 15px;"></i>
                                            <h4 style="color: #fbbf24; margin-bottom: 10px;">Verification Pending</h4>
                                            <p style="color: #a0aec0;">Please upload your Student ID to verify your
                                                account.</p>
                                        </div>
                                    </div>

                                    <div class="verification-actions" style="text-align: center;">
                                        <button class="btn btn-primary"
                                            onclick="authManager.startDocumentVerification()"
                                            style="padding: 15px 30px; font-size: 16px;">
                                            <i class="fas fa-id-card"></i>
                                            Upload Student ID
                                        </button>
                                    </div>
                                </div>
                            </div>

                            <!-- Books Tab -->
                            <div class="tab-content" id="books-content">
                                <div class="books-section">
                                    <h3>My Books</h3>
                                    <p>Manage your books here.</p>
                                </div>
                            </div>

                            <!-- Reviews Tab -->
                            <div class="tab-content" id="reviews-content">
                                <div class="reviews-section">
                                    <h3>Reviews</h3>
                                    <p>Manage your reviews here.</p>
                                </div>
                            </div>

                            <!-- Settings Tab -->
                            <div class="tab-content" id="settings-content">
                                <div class="settings-section">
                                    <h3>Settings</h3>
                                    <p>Manage your account settings here.</p>
                                </div>
                            </div>

                            <!-- Borrowing & Lending History Tab -->
                            <div class="tab-content" id="borrowing-history">
                                <div id="history-container" class="profile-history">
                                    <h3>Borrowing & Lending History</h3>
                                    <div class="history-grid">
                                        <!-- Borrowing Column -->
                                        <div class="history-column">
                                            <h4>Borrowing History</h4>
                                            <div id="borrowing-history-list" class="history-list">
                                                <!-- Borrowing history items load dynamically -->
                                            </div>
                                        </div>

                                        <!-- Lending Column -->
                                        <div class="history-column">
                                            <h4>Lending History</h4>
                                            <div id="lending-history-list" class="history-list">
                                                <!-- Lending history items load dynamically -->
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Notifications Section (Hidden for now) -->
        <section id="notifications-section" class="section" style="display: none;">
            <div class="container">
                <div class="section-header">
                    <h2 class="section-title">Notifications</h2>
                    <button class="btn btn-outline" id="mark-all-read">
                        <i class="fas fa-check-double"></i>
                        Mark All Read
                    </button>
                </div>
                <div class="notifications-list" id="notifications-list">
                    <!-- Notifications will be loaded here -->
                </div>
            </div>
        </section>
    </main>

    <!-- Modals -->
    <!-- Login Modal -->
    <div id="login-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Login to LiBrowse</h3>
                <button class="modal-close" data-modal="login-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <form id="login-form">
                    <!-- Email -->
                    <div class="form-group">
                        <label for="login-email">PLV Email</label>
                        <input type="email" id="login-email" name="email" placeholder="your.email@plv.edu.ph" required>
                        <small id="email-error" class="error-message"></small>
                    </div>

                    <!-- Password -->
                    <div class="form-group">
                        <label for="login-password">Password</label>
                        <input type="password" id="login-password" name="password" placeholder="Enter your password"
                            required>
                        <small id="password-error" class="error-message"></small>
                    </div>

                    <!-- Forgot Password -->
                    <div class="form-group forgot-password">
                        <a href="#" id="forgot-password-link">Forgot your password?</a>
                    </div>

                    <!-- Captcha -->
                    <div id="login-captcha-container" class="form-group captcha-container">
                        <div id="login-recaptcha" class="g-recaptcha" data-sitekey="">
                        </div>
                        <div id="login-captcha-fallback" class="captcha-fallback" style="display:none;">
                            <p>
                                <i class="fas fa-shield-alt"></i> CAPTCHA verification disabled in development mode
                            </p>
                        </div>
                    </div>

                    <!-- Submit -->
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-sign-in-alt"></i> Login
                    </button>
                </form>

                <div class="modal-footer">
                    <p>Doesn't have an account? <a href="#" id="switch-to-register">Register here</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Script -->
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const form = document.getElementById("login-form");
            const emailInput = document.getElementById("login-email");
            const passwordInput = document.getElementById("login-password");
            const emailError = document.getElementById("email-error");
            const passwordError = document.getElementById("password-error");

            const passwordPattern =
                /^(?=.*[a-z])(?=.*[A-Z])(?=.*\d)(?=.*[!@#$%^&*])[A-Za-z\d!@#$%^&*]{8,}$/;

            form.addEventListener("submit", async (e) => {
                e.preventDefault();
                emailError.textContent = "";
                passwordError.textContent = "";

                const email = emailInput.value.trim();
                const password = passwordInput.value.trim();

                if (!email.endsWith("@plv.edu.ph")) {
                    emailError.textContent = "Please use your PLV email address.";
                    return;
                }

                if (!passwordPattern.test(password)) {
                    passwordError.textContent =
                        "Password must be at least 8 characters long and include uppercase, lowercase, number, and special character.";
                    return;
                }

                try {
                    const response = await api.login(email, password);

                    if (response.token && response.user) {
                        localStorage.setItem("token", response.token);
                        localStorage.setItem("user", JSON.stringify(response.user));

                        const modal = document.getElementById("login-modal");
                        if (modal) modal.classList.remove("active");

                        alert("âœ… Login successful!");
                        window.location.reload();
                    } else {
                        passwordError.textContent = response.error || "Login failed.";
                    }
                } catch (err) {
                    console.error("Login error:", err);
                    passwordError.textContent = "Invalid email or password.";
                }
            });
        });
    </script>

    <!-- Forgot Password Modal -->
    <div id="forgot-password-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Forgot Password</h3>
                <button class="modal-close" data-modal="forgot-password-modal"><i class="fas fa-times"></i></button>
            </div>
            <div class="modal-body">
                <form id="forgot-password-form">
                    <label for="forgot-email">Enter your PLV email:</label>
                    <input type="email" id="forgot-email" placeholder="your.email@plv.edu.ph" required />
                    <button type="submit" class="btn btn-primary">Send Reset Link</button>
                </form>
            </div>
        </div>
    </div>


    <!-- Register Modal -->
    <div id="register-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Join LiBrowse</h3>
                <button class="modal-close" data-modal="register-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>

            <div class="modal-body">
                <form id="register-form">

                    <!-- Name Fields -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="register-firstname">First Name</label>
                            <input type="text" id="register-firstname" name="firstname" required>
                        </div>
                        <div class="form-group">
                            <label for="register-lastname">Last Name</label>
                            <input type="text" id="register-lastname" name="lastname" required>
                        </div>
                    </div>

                    <!-- Email -->
                    <div class="form-group">
                        <label for="register-email">PLV Email *</label>
                        <input type="email" id="register-email" name="email" placeholder="your.email@plv.edu.ph"
                            required>
                        <small class="form-help" style="color: #fbbf24;">Must use your PLV email address
                            (@plv.edu.ph)</small>
                    </div>

                    <!-- Student ID -->
                    <div class="form-group">
                        <label for="register-student-id">Student ID</label>
                        <input type="text" id="register-student-id" name="student_id" placeholder="e.g., 21-1234"
                            pattern="\d{2}-\d{4}" title="Format: 00-0000 (e.g., 21-1234)" required>
                        <small class="form-help">Format: 00-0000 (e.g., 21-1234)</small>
                    </div>

                    <!-- Program -->
                    <div class="form-group">
                        <label for="register-program">Program</label>
                        <select id="register-program" name="program" required>
                            <option value="">Select your program</option>
                            <option value="BSIT">BS Information Technology</option>
                            <option value="BSA">BS Accountancy</option>
                            <option value="BSED">BS Education</option>
                            <option value="BSENG">BS Engineering</option>
                        </select>
                    </div>

                    <!-- Password -->
                    <div class="form-group">
                        <label for="register-password">Password</label>
                        <div style="position: relative;">
                            <input type="password" id="register-password" name="password" required>
                            <span id="toggle-password"
                                style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;">
                                <i class="fas fa-eye-slash"></i>
                            </span>
                        </div>

                        <!-- Password Requirements -->
                        <div class="password-requirements">
                            <div class="requirements-header">Password must contain:</div>
                            <div id="req-length" class="requirement">
                                <i class="fas fa-circle"></i> <span>At least 8 characters</span>
                            </div>
                            <div id="req-uppercase" class="requirement">
                                <i class="fas fa-circle"></i> <span>One uppercase letter (A-Z)</span>
                            </div>
                            <div id="req-lowercase" class="requirement">
                                <i class="fas fa-circle"></i> <span>One lowercase letter (a-z)</span>
                            </div>
                            <div id="req-number" class="requirement">
                                <i class="fas fa-circle"></i> <span>One number (0-9)</span>
                            </div>
                            <div id="req-special" class="requirement">
                                <i class="fas fa-circle"></i> <span>One special character (!@#$%^&*)</span>
                            </div>
                        </div>
                    </div>

                    <!-- Confirm Password -->
                    <div class="form-group">
                        <label for="register-confirm-password">Confirm Password</label>
                        <div style="position: relative;">
                            <input type="password" id="register-confirm-password" name="confirm_password" required>
                            <span id="toggle-confirm-password"
                                style="position:absolute; right:10px; top:50%; transform:translateY(-50%); cursor:pointer;">
                                <i class="fas fa-eye-slash"></i>
                            </span>
                        </div>
                        <div id="password-match-indicator" class="password-match"></div>
                    </div>

                    <!-- Captcha -->
                    <div id="register-captcha-container" class="form-group captcha-container">
                        <div id="register-recaptcha" class="g-recaptcha" data-sitekey=""></div>
                        <div id="register-captcha-fallback" class="captcha-fallback" style="display:none;">
                            <p>
                                <i class="fas fa-shield-alt"></i> CAPTCHA verification disabled in development mode
                            </p>
                        </div>
                    </div>

                    <!-- Submit -->
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-user-plus"></i> Register
                    </button>
                </form>

                <div class="modal-footer">
                    <p>Already have an account?
                        <a href="#" id="switch-to-login">Login here</a>
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- SCRIPT FOR VALIDATION AND SHOW/HIDE PASSWORD -->
    <script>
        // Get elements
        const passwordInput = document.getElementById("register-password");
        const confirmPasswordInput = document.getElementById("register-confirm-password");
        const matchIndicator = document.getElementById("password-match-indicator");

        const togglePassword = document.getElementById("toggle-password");
        const toggleConfirmPassword = document.getElementById("toggle-confirm-password");

        // Password requirement elements
        const reqLength = document.getElementById("req-length");
        const reqUppercase = document.getElementById("req-uppercase");
        const reqLowercase = document.getElementById("req-lowercase");
        const reqNumber = document.getElementById("req-number");
        const reqSpecial = document.getElementById("req-special");

        // Toggle Password Visibility with proper icons
        togglePassword.addEventListener("click", () => {
            if (passwordInput.type === "password") {
                passwordInput.type = "text";
                togglePassword.innerHTML = '<i class="fas fa-eye"></i>'; // open eye
            } else {
                passwordInput.type = "password";
                togglePassword.innerHTML = '<i class="fas fa-eye-slash"></i>'; // closed eye
            }
        });

        toggleConfirmPassword.addEventListener("click", () => {
            if (confirmPasswordInput.type === "password") {
                confirmPasswordInput.type = "text";
                toggleConfirmPassword.innerHTML = '<i class="fas fa-eye"></i>'; // open eye
            } else {
                confirmPasswordInput.type = "password";
                toggleConfirmPassword.innerHTML = '<i class="fas fa-eye-slash"></i>'; // closed eye
            }
        });

        // Helper function to update requirement colors
        function updateRequirement(element, condition) {
            if (condition) {
                element.style.color = "green";
                element.querySelector("i").className = "fas fa-check-circle";
            } else {
                element.style.color = "red";
                element.querySelector("i").className = "fas fa-times-circle";
            }
        }

        // Check password requirements in real time
        passwordInput.addEventListener("input", () => {
            const value = passwordInput.value;

            const hasLength = value.length >= 8;
            const hasUppercase = /[A-Z]/.test(value);
            const hasLowercase = /[a-z]/.test(value);
            const hasNumber = /[0-9]/.test(value);
            const hasSpecial = /[!@#$%^&*]/.test(value);

            updateRequirement(reqLength, hasLength);
            updateRequirement(reqUppercase, hasUppercase);
            updateRequirement(reqLowercase, hasLowercase);
            updateRequirement(reqNumber, hasNumber);
            updateRequirement(reqSpecial, hasSpecial);

            // Update password match while typing
            checkPasswordMatch();
        });

        // Check confirm password match
        confirmPasswordInput.addEventListener("input", checkPasswordMatch);

        function checkPasswordMatch() {
            if (confirmPasswordInput.value === "") {
                matchIndicator.textContent = "";
                return;
            }

            if (passwordInput.value === confirmPasswordInput.value) {
                matchIndicator.textContent = "âœ… Passwords match";
                matchIndicator.style.color = "green";
            } else {
                matchIndicator.textContent = "âŒ Passwords do not match";
                matchIndicator.style.color = "red";
            }
        }
    </script>

    <script>
        const registerForm = document.getElementById("register-form");

        registerForm.addEventListener("submit", async function (e) {
            e.preventDefault();

            // Get form input values
            const formData = new FormData(registerForm);
            const data = Object.fromEntries(formData.entries());

            try {
                // Send data to backend
                const response = await fetch("http://localhost:3000/register", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(data)
                });

                const result = await response.json();

                if (response.ok) {
                    showSuccessMessage(result.message || "Your account has been successfully registered!");
                    registerForm.reset();
                } else {
                    alert(result.message || "Registration failed.");
                }
            } catch (error) {
                console.error("Error:", error);
                alert("Something went wrong while connecting to the server.");
            }
        });

        function showSuccessMessage(message) {
            const successMsg = document.createElement("div");
            successMsg.textContent = message;
            successMsg.className = "success-message";
            successMsg.style.backgroundColor = "#d1fae5";
            successMsg.style.color = "#065f46";
            successMsg.style.padding = "12px";
            successMsg.style.textAlign = "center";
            successMsg.style.marginTop = "15px";
            successMsg.style.borderRadius = "6px";
            successMsg.style.border = "1px solid #10b981";
            registerForm.parentNode.insertBefore(successMsg, registerForm.nextSibling);
            setTimeout(() => successMsg.remove(), 4000);
        }
    </script>



    <!-- Verification Choice Modal -->
    <div class="modal" id="verification-choice-modal">
        <div class="modal-content">
            <header class="modal-header">
                <h3>Choose Verification Method</h3>
            </header>
            <section class="modal-body">
                <p>To complete your registration, please choose how you'd like to verify your account:</p>

                <div class="verification-options">
                    <!-- OTP Verification Option -->
                    <div class="verification-option" id="otp-option">
                        <div class="option-icon">
                            <i class="fas fa-envelope"></i>
                        </div>
                        <div class="option-content">
                            <h4>Email Verification (OTP)</h4>
                            <p>We'll send a 6-digit code to your PLV email address</p>
                            <ul class="option-features">
                                <li><i class="fas fa-check"></i> Quick and easy</li>
                                <li><i class="fas fa-check"></i> Instant verification</li>
                                <li><i class="fas fa-check"></i> No document upload needed</li>
                            </ul>
                        </div>
                        <button class="btn btn-primary" id="choose-otp">
                            <i class="fas fa-envelope"></i>
                            Use Email OTP
                        </button>
                    </div>

                    <!-- Document Upload Option -->
                    <div class="verification-option" id="document-option">
                        <div class="option-icon">
                            <i class="fas fa-id-card"></i>
                        </div>
                        <div class="option-content">
                            <h4>Document Verification</h4>
                            <p>Upload your Certificate of Registration (COR) or School ID</p>
                            <ul class="option-features">
                                <li><i class="fas fa-check"></i> More secure verification</li>
                                <li><i class="fas fa-check"></i> One-time process</li>
                                <li><i class="fas fa-check"></i> Official document validation</li>
                            </ul>
                        </div>
                        <button class="btn btn-outline" id="choose-document">
                            <i class="fas fa-id-card"></i>
                            Upload Document
                        </button>
                    </div>
                </div>
            </section>
        </div>
    </div>

    <!-- OTP Verification Modal -->
    <div class="modal" id="otp-modal">
        <div class="modal-content">
            <header class="modal-header">
                <h3>Verify Your Email</h3>
                <button class="modal-close" data-modal="otp-modal">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </header>
            <section class="modal-body">
                <p>We've sent a verification code to your PLV email address. Please enter it below:</p>

                <form id="otp-form">
                    <div class="form-group">
                        <label for="otp-code">Verification Code</label>
                        <input type="text" id="otp-code" name="otp" placeholder="Enter 6-digit code" maxlength="6"
                            required>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-check"></i>
                        Verify Email
                    </button>
                </form>

                <footer class="modal-footer">
                    <p>Didn't receive the code? <a href="#" id="resend-otp">Resend OTP</a></p>
                    <p><a href="#" id="back-to-verification-choice">Choose different method</a></p>
                </footer>
            </section>
        </div>
    </div>

    <!-- Document Verification Modal -->
    <div class="modal" id="document-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Document Verification</h3>
                <button class="modal-close" data-modal="document-modal">
                    <i class="fas fa-arrow-left"></i>
                </button>
            </div>
            <div class="modal-body">
                <p>Upload your Certificate of Registration (COR) or School ID for verification:</p>

                <form id="document-form">
                    <div class="form-group">
                        <label for="document-type">Document Type</label>
                        <select id="document-type" name="documentType" required>
                            <option value="">Select document type</option>
                            <option value="cor">Certificate of Registration (COR)</option>
                            <option value="school_id">School ID</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="document-file">Upload Document</label>
                        <input type="file" id="document-file" name="document" accept="image/*,.pdf" required>
                        <div class="file-preview" id="document-preview"></div>
                        <small class="form-help">Accepted formats: JPG, PNG, PDF (Max 5MB)</small>
                    </div>

                    <div class="document-demo-notice">
                        <div class="demo-icon">
                            <i class="fas fa-info-circle"></i>
                        </div>
                        <div class="demo-content">
                            <h4>Demo Mode</h4>
                            <p>This is a demonstration. In the full version, AI will automatically verify your document.
                                For now, any uploaded document will be instantly approved.</p>
                        </div>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-upload"></i>
                        Upload & Verify Document
                    </button>
                </form>

                <div class="modal-footer">
                    <p><a href="#" id="back-to-verification-choice-2">Choose different method</a></p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add Book Modal -->
    <div class="modal" id="add-book-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Add New Book</h3>
                <button class="modal-close" data-modal="add-book-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="add-book-form">
                    <div class="form-row">
                        <div class="form-group">
                            <label for="book-title">Book Title</label>
                            <input type="text" id="book-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="book-author">Author</label>
                            <input type="text" id="book-author" name="author" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="book-isbn">ISBN (Optional)</label>
                            <input type="text" id="book-isbn" name="isbn">
                        </div>
                        <div class="form-group">
                            <label for="book-edition">Edition</label>
                            <input type="text" id="book-edition" name="edition">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="book-program">Program</label>
                            <select id="book-program" name="program" required>
                                <option value="">Select program</option>
                                <option value="BSIT">BS Information Technology</option>
                                <option value="BSA">BS Accountancy</option>
                                <option value="BSED">BS Education</option>
                                <option value="BSENG">BS Engineering</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="book-course-code">Course Code</label>
                            <input type="text" id="book-course-code" name="course_code" placeholder="e.g., IT101">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="book-condition">Condition</label>
                            <select id="book-condition" name="condition" required>
                                <option value="">Select condition</option>
                                <option value="excellent">Excellent</option>
                                <option value="good">Good</option>
                                <option value="fair">Fair</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="book-min-credit">Minimum Credit Required</label>
                            <select id="book-min-credit" name="minimum_credits" required>
                                <option value="">Select credit requirement</option>
                                <option value="50">50 Credits - Very Low Quality/Damaged Books</option>
                                <option value="80">80 Credits - Fair Condition Books</option>
                                <option value="100" selected>100 Credits - Standard (Good Condition)</option>
                                <option value="120">120 Credits - Excellent Condition</option>
                                <option value="150">150 Credits - Premium/Rare Books</option>
                                <option value="200">200 Credits - High-Value/New Books</option>
                            </select>
                            <small class="form-help">
                                Higher credit requirements ensure only responsible borrowers can access your book.
                                <br><strong>Tip:</strong> The system will auto-suggest based on book condition.
                            </small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="book-description">Description</label>
                        <textarea id="book-description" name="description" rows="3"
                            placeholder="Additional details about the book..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="book-image">Book Image</label>
                        <input type="file" id="book-image" name="image" accept="image/*">
                        <div class="file-preview" id="book-image-preview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-plus"></i>
                        Add Book
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Edit Book Modal -->
    <div class="modal" id="edit-book-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Edit Book</h3>
                <button class="modal-close" data-modal="edit-book-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="edit-book-form">
                    <input type="hidden" id="edit-book-id" name="book_id">

                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-book-title">Book Title</label>
                            <input type="text" id="edit-book-title" name="title" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-book-author">Author</label>
                            <input type="text" id="edit-book-author" name="author" required>
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-book-isbn">ISBN (Optional)</label>
                            <input type="text" id="edit-book-isbn" name="isbn">
                        </div>
                        <div class="form-group">
                            <label for="edit-book-edition">Edition</label>
                            <input type="text" id="edit-book-edition" name="edition">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-book-course-code">Course Code</label>
                            <input type="text" id="edit-book-course-code" name="course_code" required
                                placeholder="e.g., IT101">
                        </div>
                        <div class="form-group">
                            <label for="edit-book-subject">Subject</label>
                            <input type="text" id="edit-book-subject" name="subject"
                                placeholder="e.g., Programming Fundamentals">
                        </div>
                    </div>
                    <div class="form-row">
                        <div class="form-group">
                            <label for="edit-book-condition">Condition</label>
                            <select id="edit-book-condition" name="condition" required>
                                <option value="">Select condition</option>
                                <option value="excellent">Excellent</option>
                                <option value="good">Good</option>
                                <option value="fair">Fair</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label for="edit-book-min-credit">Minimum Credit Required</label>
                            <select id="edit-book-min-credit" name="minimum_credits" required>
                                <option value="">Select credit requirement</option>
                                <option value="50">50 Credits - Very Low Quality/Damaged Books</option>
                                <option value="80">80 Credits - Fair Condition Books</option>
                                <option value="100">100 Credits - Standard (Good Condition)</option>
                                <option value="120">120 Credits - Excellent Condition</option>
                                <option value="150">150 Credits - Premium/Rare Books</option>
                                <option value="200">200 Credits - High-Value/New Books</option>
                            </select>
                            <small class="form-help">
                                Higher credit requirements ensure only responsible borrowers can access your book.
                                <br><strong>Tip:</strong> The system will auto-suggest based on book condition.
                            </small>
                        </div>
                    </div>
                    <div class="form-group">
                        <label for="edit-book-description">Description</label>
                        <textarea id="edit-book-description" name="description" rows="3"
                            placeholder="Additional details about the book..."></textarea>
                    </div>
                    <div class="form-group">
                        <label for="edit-book-image">Update Book Image (Optional)</label>
                        <input type="file" id="edit-book-image" name="image" accept="image/*">
                        <div class="file-preview" id="edit-book-image-preview"></div>
                        <div id="current-book-image" class="current-image-preview"></div>
                    </div>
                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-save"></i>
                        Update Book
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Borrow Request Modal -->
    <div class="modal" id="borrow-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Borrow Request</h3>
                <button class="modal-close" data-modal="borrow-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="borrow-book-info" class="book-info-header"></div>

                <form id="borrow-form">
                    <input type="hidden" id="borrow-book-id" name="book_id">

                    <div class="form-group">
                        <label for="request-message">Reason for Borrowing *</label>
                        <textarea id="request-message" name="request_message" rows="3" required
                            placeholder="Explain why you need this book, how it will help your studies, and how you'll take care of it..."></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="borrower-contact">Your Contact Information *</label>
                            <input type="text" id="borrower-contact" name="borrower_contact" required
                                placeholder="Phone number or preferred contact method">
                        </div>
                        <div class="form-group">
                            <label for="pickup-method">Pickup Method *</label>
                            <select id="pickup-method" name="pickup_method" required>
                                <option value="pickup">I'll pick up from lender</option>
                                <option value="meetup">Meet at agreed location</option>
                                <option value="delivery">Request delivery (if available)</option>
                            </select>
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="borrower-address">Your Address (Optional)</label>
                        <textarea id="borrower-address" name="borrower_address" rows="2"
                            placeholder="Your address for pickup/delivery arrangements"></textarea>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="pickup-location">Preferred Meeting Location *</label>
                            <input type="text" id="pickup-location" name="pickup_location" required
                                placeholder="e.g., PLV Library, Main Campus Gate, etc.">
                        </div>
                        <div class="form-group">
                            <label for="preferred-pickup-time">Preferred Pickup Time</label>
                            <input type="datetime-local" id="preferred-pickup-time" name="preferred_pickup_time">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="expected-return-date">Expected Return Date *</label>
                            <input type="date" id="expected-return-date" name="expected_return_date" required>
                        </div>
                        <div class="form-group">
                            <label for="borrow-duration">How Long Will You Borrow?</label>
                            <select id="borrow-duration" name="borrow_duration">
                                <option value="">Select duration</option>
                                <option value="1-week">1 Week</option>
                                <option value="2-weeks">2 Weeks</option>
                                <option value="3-weeks">3 Weeks</option>
                                <option value="1-month">1 Month</option>
                                <option value="custom">Custom (specify in return date)</option>
                            </select>
                        </div>
                    </div>

                    <div class="credit-requirement-section">
                        <h4>Credit Requirements</h4>
                        <div class="credit-info-grid">
                            <div class="credit-info-item">
                                <span class="credit-label">Required Credits:</span>
                                <span id="required-credits" class="credit-value required">0</span>
                            </div>
                            <div class="credit-info-item">
                                <span class="credit-label">Your Credits:</span>
                                <span id="user-credits-modal" class="credit-value current">0</span>
                            </div>
                        </div>
                        <div id="credit-status" class="credit-status-message"></div>
                    </div>

                    <button type="submit" id="submit-borrow-request" class="btn btn-primary btn-full">
                        <i class="fas fa-paper-plane"></i>
                        Send Borrow Request
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Chat Modal - Rebuilt from scratch -->
    <div class="modal" id="chat-modal" role="dialog" aria-modal="true">
        <div class="chat-modal-backdrop"></div>
        <div class="chat-modal-container">
            <!-- Chat Header -->
            <div class="chat-modal-header">
                <div class="chat-user-info">
                    <h2 id="chat-title" class="chat-user-name">Chat with User</h2>
                    <p id="chat-book-info" class="chat-book-title">About: Book Title</p>
                </div>
                <div class="chat-header-buttons">
                    <button type="button" class="chat-btn-icon" id="report-chat-btn" title="Report user">
                        <i class="fas fa-flag"></i>
                    </button>
                    <button type="button" class="chat-btn-icon" id="cancel-transaction-btn" title="Cancel transaction">
                        <i class="fas fa-times-circle"></i>
                    </button>
                    <button type="button" class="chat-btn-close" data-modal="chat-modal" title="Close">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            </div>

            <!-- Info Banner -->
            <div class="chat-info-banner">
                <i class="fas fa-info-circle"></i>
                <span id="chat-banner-text">Chat created for "test book" transaction. Discuss pickup details and
                    terms.</span>
            </div>

            <!-- Messages Area -->
            <div class="chat-messages-area">
                <button id="load-more-messages" class="chat-load-more" style="display: none;">
                    <i class="fas fa-chevron-up"></i> Load Earlier Messages
                </button>
                <div id="chat-messages" class="chat-messages" role="log"></div>
                <div id="typing-indicator" class="chat-typing" style="display: none;">
                    <span></span><span></span><span></span>
                </div>
            </div>

            <!-- Input Area -->
            <div class="chat-input-section">
                <form id="chat-form">
                    <input type="hidden" id="chat-id">
                    <div class="chat-input-box">
                        <textarea id="chat-message-input" class="chat-textarea" placeholder="Type a message..."
                            maxlength="1000" rows="1"></textarea>
                        <div class="chat-input-controls">
                            <button type="button" class="chat-btn-icon" id="attach-file-btn" title="Attach file">
                                <i class="fas fa-paperclip"></i>
                            </button>
                            <button type="submit" class="chat-btn-send">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </div>
                    <div class="chat-char-count"><span id="character-count">0</span> / 1000</div>
                    <input type="file" id="file-input" style="display: none;" accept="image/*">
                </form>
            </div>
        </div>
    </div>

    <!-- Report Modal -->
    <div class="modal" id="report-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Report User</h3>
                <button class="modal-close" data-modal="report-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="report-form">
                    <input type="hidden" id="report-chat-id" name="chat_id">
                    <input type="hidden" id="report-user-id" name="reported_user_id">

                    <div class="form-group">
                        <label for="report-reason">Reason for Report *</label>
                        <select id="report-reason" name="reason" required>
                            <option value="">Select a reason</option>
                            <option value="spam">Spam</option>
                            <option value="abuse">Harassment/Abuse</option>
                            <option value="scam">Scam/Fraud</option>
                            <option value="other">Other</option>
                        </select>
                    </div>

                    <div class="form-group">
                        <label for="report-description">Additional Details</label>
                        <textarea id="report-description" name="description" rows="4"
                            placeholder="Please provide more details about the issue..."></textarea>
                    </div>

                    <button type="submit" class="btn btn-primary btn-full">
                        <i class="fas fa-flag"></i>
                        Submit Report
                    </button>
                </form>
            </div>
        </div>
    </div>

    <!-- Cancel Transaction Modal -->
    <div class="modal" id="cancel-transaction-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Cancel Transaction</h3>
                <button class="modal-close" data-modal="cancel-transaction-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="warning-message">
                    <i class="fas fa-exclamation-triangle"></i>
                    <p><strong>Are you sure you want to cancel this transaction?</strong></p>
                    <p>This action cannot be undone. The book will become available again and the chat will be closed.
                    </p>
                </div>

                <form id="cancel-transaction-form">
                    <input type="hidden" id="cancel-transaction-id" name="transaction_id">

                    <div class="form-group">
                        <label for="cancellation-reason">Reason for Cancellation *</label>
                        <textarea id="cancellation-reason" name="cancellation_reason" rows="4" required
                            placeholder="Please explain why you're cancelling this transaction (minimum 10 characters)..."></textarea>
                        <small class="form-help">Be specific about the disagreement or issue that led to this
                            cancellation.</small>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" data-close-modal="cancel-transaction-modal">
                            Keep Transaction
                        </button>
                        <button type="submit" class="btn btn-error">
                            <i class="fas fa-ban"></i>
                            Cancel Transaction
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Transaction Status Update Modal -->
    <div class="modal" id="status-update-modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 id="status-update-title">Update Transaction Status</h3>
                <button class="modal-close" data-close-modal="status-update-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div id="status-update-content">
                    <!-- Dynamic content will be loaded here -->
                </div>

                <form id="status-update-form">
                    <input type="hidden" id="update-transaction-id" name="transaction_id">
                    <input type="hidden" id="update-new-status" name="new_status">

                    <div class="form-group" id="status-notes-group" style="display: none;">
                        <label for="status-notes">Notes (Optional)</label>
                        <textarea id="status-notes" name="notes" rows="3"
                            placeholder="Add any additional notes about this status update..."></textarea>
                    </div>

                    <div class="form-group" id="return-condition-group" style="display: none;">
                        <label for="return-condition">Book Condition *</label>
                        <select id="return-condition" name="return_condition">
                            <option value="">Select condition</option>
                            <option value="excellent">Excellent - Like new</option>
                            <option value="good">Good - Minor wear</option>
                            <option value="fair">Fair - Noticeable wear</option>
                            <option value="poor">Poor - Significant wear</option>
                            <option value="damaged">Damaged - Requires repair</option>
                        </select>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" data-close-modal="status-update-modal">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary" id="status-update-btn">
                            <i class="fas fa-check"></i>
                            Update Status
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Feedback Modal -->
    <div class="modal" id="feedback-modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3>Submit Feedback</h3>
                <button class="modal-close" data-close-modal="feedback-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="feedback-transaction-info" id="feedback-transaction-info">
                    <!-- Transaction info will be populated here -->
                </div>

                <form id="feedback-form">
                    <input type="hidden" id="feedback-transaction-id" name="transaction_id">

                    <div class="form-group">
                        <label for="feedback-rating">Overall Rating *</label>
                        <div class="rating-input">
                            <div class="stars" id="feedback-stars">
                                <i class="fas fa-star" data-rating="1"></i>
                                <i class="fas fa-star" data-rating="2"></i>
                                <i class="fas fa-star" data-rating="3"></i>
                                <i class="fas fa-star" data-rating="4"></i>
                                <i class="fas fa-star" data-rating="5"></i>
                            </div>
                            <span class="rating-text" id="rating-text">Click to rate</span>
                        </div>
                        <input type="hidden" id="feedback-rating" name="rating" required>
                    </div>

                    <div class="form-group">
                        <label for="feedback-comment">Comment</label>
                        <textarea id="feedback-comment" name="comment" rows="4"
                            placeholder="Share your experience with this transaction..."></textarea>
                    </div>

                    <div class="form-group" id="book-condition-group" style="display: none;">
                        <label for="book-condition-rating">Book Condition When Returned</label>
                        <select id="book-condition-rating" name="book_condition_rating">
                            <option value="">Select condition</option>
                            <option value="excellent">Excellent</option>
                            <option value="good">Good</option>
                            <option value="fair">Fair</option>
                            <option value="poor">Poor</option>
                            <option value="damaged">Damaged</option>
                        </select>
                    </div>

                    <div class="form-group" id="return-timeliness-group" style="display: none;">
                        <label for="return-timeliness">Return Timeliness</label>
                        <select id="return-timeliness" name="return_timeliness">
                            <option value="">Select timeliness</option>
                            <option value="early">Returned Early</option>
                            <option value="on_time">Returned On Time</option>
                            <option value="late">Returned Late</option>
                        </select>
                    </div>

                    <div class="credit-impact-info" id="credit-impact-info" style="display: none;">
                        <h4>Credit Impact</h4>
                        <div class="credit-preview" id="credit-preview">
                            <!-- Credit impact preview will be shown here -->
                        </div>
                    </div>

                    <div class="form-actions">
                        <button type="button" class="btn btn-outline" data-close-modal="feedback-modal">
                            Cancel
                        </button>
                        <button type="submit" class="btn btn-primary">
                            <i class="fas fa-star"></i>
                            Submit Feedback
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    </div>
    <!-- Toast Notifications -->
    <div class="toast-container" id="toast-container"></div>

    <!-- Book Details Modal -->
    <div id="book-details-modal" class="modal">
        <div class="modal-content modal-large">
            <div class="modal-header">
                <h3 id="modal-book-title">Book Details</h3>
                <button class="modal-close" data-modal="book-details-modal">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <div class="book-details-content">
                    <div class="book-details-image">
                        <img id="modal-book-image" src="" alt="Book cover"
                            onerror="this.style.display='none'; this.nextElementSibling.style.display='flex';">
                        <div class="book-image-fallback"
                            style="display: none; width: 100%; height: 100%; background: var(--bg-secondary); align-items: center; justify-content: center; font-size: 4rem; color: var(--text-muted);">
                            <i class="fas fa-book"></i>
                        </div>
                        <div class="book-status-badge" id="modal-book-status"></div>
                    </div>
                    <div class="book-details-info">
                        <div class="book-details-section collapsible">
                            <h4 class="section-header" data-toggle="basic-info">
                                <span>Basic Information</span>
                                <i class="fas fa-chevron-down toggle-icon"></i>
                            </h4>
                            <div class="section-content" id="basic-info">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Title</label>
                                        <span id="modal-book-title-text"></span>
                                    </div>
                                    <div class="info-item">
                                        <label>Author</label>
                                        <span id="modal-book-author"></span>
                                    </div>
                                    <div class="info-item">
                                        <label>ISBN</label>
                                        <span id="modal-book-isbn"></span>
                                    </div>
                                    <div class="info-item">
                                        <label>Publisher</label>
                                        <span id="modal-book-publisher"></span>
                                    </div>
                                    <div class="info-item">
                                        <label>Publication Year</label>
                                        <span id="modal-book-year"></span>
                                    </div>
                                    <div class="info-item">
                                        <label>Edition</label>
                                        <span id="modal-book-edition"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="book-details-section collapsible collapsed">
                            <h4 class="section-header" data-toggle="course-info">
                                <span>Course Information</span>
                                <i class="fas fa-chevron-down toggle-icon"></i>
                            </h4>
                            <div class="section-content" id="course-info">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Course Code</label>
                                        <span id="modal-book-course-code"></span>
                                    </div>
                                    <div class="info-item">
                                        <label>Subject</label>
                                        <span id="modal-book-subject"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="book-details-section collapsible collapsed">
                            <h4 class="section-header" data-toggle="condition-info">
                                <span>Book Condition & Requirements</span>
                                <i class="fas fa-chevron-down toggle-icon"></i>
                            </h4>
                            <div class="section-content" id="condition-info">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Condition</label>
                                        <span id="modal-book-condition"></span>
                                    </div>
                                    <div class="info-item">
                                        <label>Minimum Credits</label>
                                        <span id="modal-book-credits"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="book-details-section collapsible collapsed">
                            <h4 class="section-header" data-toggle="owner-info">
                                <span>Owner Information</span>
                                <i class="fas fa-chevron-down toggle-icon"></i>
                            </h4>
                            <div class="section-content" id="owner-info">
                                <div class="info-grid">
                                    <div class="info-item">
                                        <label>Owner</label>
                                        <span id="modal-book-owner"></span>
                                    </div>
                                    <div class="info-item">
                                        <label>Program</label>
                                        <span id="modal-book-owner-program"></span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="book-details-section collapsible" id="modal-book-description-section"
                            style="display: none;">
                            <h4 class="section-header" data-toggle="description-info">
                                <span>Description</span>
                                <i class="fas fa-chevron-down toggle-icon"></i>
                            </h4>
                            <div class="section-content" id="description-info">
                                <p id="modal-book-description"></p>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Similar Books Section -->
                <div class="similar-books-section" id="similar-books-section" style="display: none;">
                    <h4><i class="fas fa-book-reader"></i> Similar Books You Might Like</h4>
                    <div class="similar-books-grid" id="similar-books-grid">
                        <!-- Similar books will be loaded here -->
                    </div>
                </div>
            </div>
            <div class="modal-footer">
                <button class="btn btn-outline" onclick="app.closeModal('book-details-modal')">
                    <i class="fas fa-times"></i>
                    Close
                </button>
                <button class="btn btn-primary" id="modal-request-book" onclick="booksManager.requestBookFromModal()">
                    <i class="fas fa-hand-paper"></i>
                    Request Book
                </button>
            </div>
        </div>
    </div>


    <!-- Borrow Request Modal -->
    <div id="borrow-request-modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Borrow Request</h3>
                <button class="modal-close"
                    onclick="document.getElementById('borrow-request-modal').classList.remove('active')">
                    <i class="fas fa-times"></i>
                </button>
            </div>
            <div class="modal-body">
                <form id="borrow-request-form">
                    <input type="hidden" id="request-book-id" />
                    <div class="form-row">
                        <div class="form-group">
                            <label for="pickup-method">Pickup Method</label>
                            <select id="pickup-method" required>
                                <option value="pickup">Pickup</option>
                                <option value="meet">Meet</option>
                                <option value="ship">Delivery</option>
                            </select>
                            <small id="err-pickup-method" class="error-message"></small>
                        </div>
                        <div class="form-group">
                            <label for="pickup-location">Pickup/Meet Location</label>
                            <input type="text" id="pickup-location" placeholder="e.g., PLV Library entrance" required />
                            <small id="err-pickup-location" class="error-message"></small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="borrow-start-date">Borrow Start Date</label>
                            <input type="date" id="borrow-start-date" aria-describedby="err-borrow-start-date"
                                required />
                            <small id="err-borrow-start-date" class="error-message"></small>
                        </div>
                        <div class="form-group">
                            <label for="borrow-duration">Borrow Duration</label>
                            <select id="borrow-duration" required aria-describedby="err-borrow-duration">
                                <option value="">Select duration</option>
                                <option value="1w">1 week</option>
                                <option value="2w">2 weeks</option>
                                <option value="3w">3 weeks</option>
                                <option value="1m">1 month</option>
                            </select>
                            <small id="err-borrow-duration" class="error-message"></small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="expected-return-date">Expected Return Date</label>
                            <input type="text" id="expected-return-date" disabled
                                aria-describedby="erd-help erd-closure-note" />
                            <small id="erd-help" class="help-text">Auto-calculated from Start Date and Duration.</small>
                            <small id="erd-closure-note" class="muted" style="display: none;">Adjusted for
                                closure.</small>
                            <span id="erd-live" class="visually-hidden" role="status" aria-live="polite"></span>
                            <small id="err-expected-return-date" class="error-message"></small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group">
                            <label for="preferred-pickup-time">Preferred Pickup Time</label>
                            <input type="datetime-local" id="preferred-pickup-time" />
                            <small id="err-preferred-pickup-time" class="error-message"></small>
                        </div>
                        <div class="form-group">
                            <label for="request-contact">Your Contact</label>
                            <input type="text" id="request-contact" placeholder="e.g., 0917..., FB: name" required />
                            <small id="err-request-contact" class="error-message"></small>
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-group" style="flex: 1;">
                            <label for="request-address">Your Address (optional)</label>
                            <input type="text" id="request-address" placeholder="Optional address" />
                        </div>
                    </div>

                    <div class="form-group">
                        <label for="request-message">Message to owner</label>
                        <textarea id="request-message" rows="3"
                            placeholder="Reason and any helpful details (min 10 chars)" required></textarea>
                        <small id="err-request-message" class="error-message"></small>
                    </div>

                    <div class="modal-footer" style="justify-content: flex-end; gap: 8px;">
                        <button type="button" class="btn btn-outline"
                            onclick="document.getElementById('borrow-request-modal').classList.remove('active')">Cancel</button>
                        <button id="borrow-request-submit" type="submit" class="btn btn-primary">
                            <i class="fas fa-paper-plane"></i>
                            Send Request
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Scripts -->
    <script src="./js/utils.js"></script>
    <script src="./js/api.js"></script>
    <script src="./js/captcha.js"></script>
    <script src="./js/auth.js"></script>
    <script src="./js/main.js"></script>
    <script src="./js/books.js"></script>
    <script src="./js/requests.js"></script>
    <script src="./js/monitoring.js?v=20251028v7"></script>
    <script src="./js/bookManagement.js"></script>

    <!-- Socket.IO Client -->
    <script src="/socket.io/socket.io.js"></script>

    <!-- Chat System Scripts -->
    <script src="./js/socket-client.js"></script>
    <script src="./js/chat.js"></script>

    <!-- Profile Tab Switching Script -->
    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // Setup profile tab switching
            const profileTabBtns = document.querySelectorAll('.profile-tabs .tab-btn');
            profileTabBtns.forEach(btn => {
                btn.addEventListener('click', () => {
                    // Remove active from all buttons
                    profileTabBtns.forEach(b => b.classList.remove('active'));
                    // Add active to clicked button
                    btn.classList.add('active');

                    // Hide all tab contents
                    document.querySelectorAll('.profile-tab-content .tab-content').forEach(content => {
                        content.style.display = 'none';
                    });

                    // Show selected tab content
                    const tabName = btn.getAttribute('data-tab');
                    const tabContent = document.getElementById(`${tabName}-content`);
                    if (tabContent) {
                        tabContent.style.display = 'block';
                    }

                    // Load books when Books tab is clicked
                    if (tabName === 'books' && typeof bookManagement !== 'undefined') {
                        bookManagement.loadMyBooks();
                    }
                });
            });
        });
    </script>

    <script>
        // Close mobile menu when modal opens
        document.addEventListener('DOMContentLoaded', () => {
            const modals = document.querySelectorAll('.modal');
            const navToggle = document.getElementById('nav-toggle');
            const navMenu = document.getElementById('nav-menu');

            modals.forEach(modal => {
                const observer = new MutationObserver((mutations) => {
                    mutations.forEach((mutation) => {
                        if (mutation.attributeName === 'class') {
                            if (modal.classList.contains('active') || modal.classList.contains('show')) {
                                if (navToggle && navMenu) {
                                    navToggle.classList.remove('active');
                                    navMenu.classList.remove('active');
                                    document.body.classList.remove('menu-open');
                                }
                            }
                            const anyActive = document.querySelector('.modal.active, .modal.show');
                            document.body.style.overflow = anyActive ? 'hidden' : '';
                        }
                    });
                });

                observer.observe(modal, { attributes: true });
            });
        });
    </script>

</body>

</html>